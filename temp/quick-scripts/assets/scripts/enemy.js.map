{"version":3,"sources":["enemy.js"],"names":["mEmitter","require","config","cc","Class","extends","Component","properties","hit_frame","SpriteFrame","hp","speed","set","value","_speed","score","_sprite","_anim","_gameState","_updateGameState","onLoad","gameState","PLAYING","getComponent","Sprite","colider","PolygonCollider","Animation","updateGameState","bind","instance","registerEvent","event","UPDATE_GAMESTATE","data","stop","start","onEnemyKilled","removeEvent","node","destroy","onCollisionEnter","other","self","group","play","_clips","_name","tween","delay","call","emit","UPDATE_SCORE","spriteFrame","update","dt","y"],"mappings":"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","file":"enemy.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["const mEmitter = require(\"mEmitter\");\nconst config = require(\"config\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        hit_frame: cc.SpriteFrame,\n        hp: 5,\n        speed: {\n            set: function (value) {\n                this._speed = value;\n            },\n        },\n\n        score: 1,\n        _sprite: null,\n        _anim: null,\n        _gameState: null,\n        _updateGameState: null,\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this._gameState = config.gameState.PLAYING\n        this._sprite = this.getComponent(cc.Sprite)\n        this.colider = this.getComponent(cc.PolygonCollider)\n        this._anim = this.getComponent(cc.Animation)\n        this._updateGameState = this.updateGameState.bind(this)\n        mEmitter.instance.registerEvent(config.event.UPDATE_GAMESTATE, this._updateGameState)\n    },\n    updateGameState(data) {\n        this._gameState = data\n        if (data != config.gameState.PLAYING)\n            this._anim.stop()\n        else\n            this._anim.start()\n    },\n    onEnemyKilled() {\n        mEmitter.instance.removeEvent(config.event.UPDATE_GAMESTATE, this._updateGameState)\n        this.node.destroy();\n    },\n    onCollisionEnter: function (other, self) {\n        if (other.node.group == \"bullet\") {\n            this.hp -= 1;\n            if (this.hp == 0) {\n                this._anim.play(this._anim._clips[0]._name)\n                cc.tween(this.node)\n                    .delay(1)\n                    .call(() => {\n                        mEmitter.instance.emit(config.event.UPDATE_SCORE, this.score)\n                        this.onEnemyKilled()\n                    })\n                    .start()\n            }\n            else if (this._sprite.spriteFrame !== this.hit_frame && this.hp > 0) {\n                this._sprite.spriteFrame = this.hit_frame\n                this._anim.stop()\n            }\n        }\n    },\n    start() {\n    },\n    update(dt) {\n        if (this._gameState == config.gameState.PLAYING)\n            this.node.y -= this._speed;\n        if (this.node.y <= -550) {\n            this.onEnemyKilled()\n        }\n    },\n});\n"]}